<!doctype html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Settings</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/slider.css">
  <link rel="stylesheet" href="../css/colorpicker.css">
  <link rel="stylesheet" href="../css/bootstrapSwitch.css">
  <script src="../js/jquery-1.9.1.min.js"></script>
  <script src="../js/common.js"</script>
  <script src="../js/modernizr-2.5.3.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/bootstrap-slider.js"></script>
  <script src="../js/bootstrap-colorpicker.js"></script>
  <script src="../js/bootstrapSwitch.js"></script>

<style>
body {
    background-color: black;
    color: #08c;
}

label {
    margin-bottom: 0px;
}

.btn .caret {
    margin-left: 5px; !important
}

.switch-right {
    padding-left: 2px;
    padding-right: 2px;
}

.well {
    padding: 10px;
    background-color: #000000;
    border: 1px solid rgb(0, 87, 80);
}

.row {
    margin: 10px 0;
}

.switch-left {
    padding-left: 2px;
    padding-right: 2px;
}

.btn-blank {
    display: inline-block;
    padding: 4px 10px 4px;
    margin-bottom: 0;
    font-size: 13px;
    line-height: 18px;
    color: #333;
    text-align: center;
    text-shadow: 0 1px 1px rgba(255,255,255,0.75);
    vertical-align: middle;
    cursor: pointer;
    background-color: #f5f5f5;
    background-repeat: repeat-x;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    filter: progid:dximagetransform.microsoft.gradient(startColorstr='#ffffff',endColorstr='#e6e6e6',GradientType=0);
    filter: progid:dximagetransform.microsoft.gradient(enabled=false);
    -webkit-box-shadow: inset 0 1px 0 rgba(255,255,255,0.2),0 1px 2px rgba(0,0,0,0.05);
    -moz-box-shadow: inset 0 1px 0 rgba(255,255,255,0.2),0 1px 2px rgba(0,0,0,0.05);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.2),0 1px 2px rgba(0,0,0,0.05);
    height: 26px;
}

.option-label {
    color: #08c;
    font-weight: bold;
    padding-right: 5px;
}

.button-option-label {
    color: #08c;
    font-weight: bold;
    padding-bottom: 14px;
    padding-right: 5px;
    vertical-align: middle;
}

</style>

<script type="text/javascript">

var Widgets = (function()
{
    function create_option_container(name, label_cls)
    {
        var tag_name = make_tag_name(name);
        var ctr = $('<div>').attr('class', 'row form-inline well')
                            .attr('id', tag_name + '-container');
        var label = create_label(name, label_cls);
        ctr.append(label);
        return ctr;
    }

    function create_label(text, cls)
    {
        cls = cls || 'option-label';
        var row = $('<span>').attr('class', 'span3');
        var label = $('<label>').attr('class', cls)
                                .text(text);
        row.append(label);
        return row;
    }

    function make_tag_name(name)
    {
        return name.toLowerCase().replace(' ', '-');
    }

    function Selection(name, choices)
    {
        function bind_callbacks()
        {
            var that = this;
            this.dropdown.children('li').click(function() {
                that.button_label.text($(this).text());
            });
        }

        function make_button_container()
        {
            return $('<div>').attr('class', 'input-append btn-group');
        }

        function make_dropdown()
        {
            var ul = $('<ul>').attr('id', this.tag_name)
                              .attr('class', 'dropdown-menu');
            for (var i=0; i<this.choices.length; i++)
            {
                var li = $('<li>');
                var a = $('<a>').attr('href', '#').text(this.choices[i]);
                li.append(a);
                ul.append(li);
            }
            return ul;
        }

        function make_button()
        {
            var a = $('<a>').attr('class', 'btn btn-info dropdown-toggle p')
                            .attr('data-toggle', 'dropdown')
                            .attr('href', '#');
            var label = $('<span>').attr('id', this.tag_name + '-label')
                                   .text(this.choices[0]);
            var caret = $('<span>').attr('class', 'caret');
            this.button_label = label;
            a.append(label).append(caret);
            return a;
        }

        function create()
        {
            this.container = create_option_container(this.name, 'button-option-label');
            this.label = this.container.children();
            this.button_container = make_button_container.call(this);
            this.container.append(this.button_container);
            this.button = make_button.call(this);
            this.button_container.append(this.button);
            this.dropdown = make_dropdown.call(this);
            this.button_container.append(this.dropdown);
            bind_callbacks.call(this);
            return this.container;
        }

        var obj = {
            create: create,
            name: name,
            tag_name: make_tag_name(name),
            label: null,
            container: null,

            choices: choices,
            dropdown: null,
            button: null,
            button_label: null,
            button_container: null
        };

        obj.create();
        return obj;
    }

    function Color(color)
    {
        function componentToHex(c) {
            var hex = c.toString(16);
            return (hex.length == 1) ? "0" + hex : hex;
        }

        return {
            color: color,

            r: function() { return this.color[0]; },
            g: function() { return this.color[1]; },
            b: function() { return this.color[2]; },

            toString: function() {
                return 'rgb(' + this.r() + ', ' + this.g() + ', ' + this.b() + ')';
            },

            toHex: function() {
                return "#" + componentToHex(this.r()) +
                             componentToHex(this.g()) +
                             componentToHex(this.b());
            }
        };
    }

    function ColorPicker(name, _color)
    {
        _color = _color || [200, 20, 20];
        color = Color(_color);

        function make_button()
        {
            var btn = $('<button>').attr('type', 'submit')
                                   .attr('class', 'btn-blank colorpicker')
                                   .attr('data-color', this.color.toString())
                                   .css('background-color', this.color.toHex())
                                   .text(' ');
            return btn;
        }

        function bind_colorpicker()
        {
            this.button.colorpicker().on('changeColor', function(ev) {
                $(this).css('background-color', ev.color.toHex());
            });
        }

        function create()
        {
            this.container = create_option_container(this.name);
            this.button = make_button.call(this);
            this.container.append(this.button);
            bind_colorpicker.call(this);
            return this.container;
        }

        var obj = {
            create: create,
            name: name,
            tag_name: make_tag_name(name),
            container: null,

            button: null,
            color: color
        };

        obj.create();
        return obj;
    }

    function StringInput(name, current_value)
    {
        function make_input()
        {
            var input = $('<input>').attr('type', 'text')
            if (current_value)
                input.val(current_value);
            return input;
        }

        function create()
        {
            this.container = create_option_container(this.name);
            this.input = make_input.call(this);
            this.container.append(this.input);
            return this.container;
        }

        var obj = {
            create: create,
            name: name,
            tag_name: make_tag_name(name),
            container: null,

            input: null
        };

        obj.create();
        return obj;
    }

    function ToggleButton(name, on, off)
    {
        on = (on === undefined) ? 'On' : on;
        off = (off === undefined) ? 'Off' : off;

        function make_button()
        {
            var outer = $('<div>').attr('class', 'switch')
                                  .attr('data-on', 'info')
                                  .attr('data-on-label', on)
                                  .attr('data-off-label', off);
            var input = $('<input>').attr('type', 'checkbox');
            outer.append(input);
            outer.bootstrapSwitch();
            return outer;
        }

        function create()
        {
            this.container = create_option_container(this.name);
            this.button = make_button.call(this);
            this.container.append(this.button);
            return this.container;
        }

        var obj = {
            create: create,
            name: name,
            tag_name: make_tag_name(name),
            container: null,

            button: null
        };

        obj.create();
        return obj;
    }

    function Slider(name, slider_opts)
    {
        slider_opts = slider_opts || {};
        function load_widget(opts)
        {
            opts = opts || slider_opts;
            slider_opts.handle = slider_opts.handle || 'square';
            this.slider.slider(slider_opts);
        }

        function make_slider()
        {
            return $('<input>').attr('type', 'text')
                               .attr('class', 'slider');
        }

        function create()
        {
            this.container = create_option_container(this.name);
            this.slider = make_slider.call(this);
            this.container.append(this.slider);
            return this.container;
        }

        var obj = {
            create: create,
            name: name,
            tag_name: make_tag_name(name),
            container: null,

            load_widget: load_widget,
            slider: null
        };

        obj.create();
        return obj;
    }

    return {
        choices: Selection,
        slider: Slider,
        string_input: StringInput,
        color_picker: ColorPicker,
        toggle: ToggleButton
    };

}());

$(function() {

var main = $('#main');

// TODO -- all args should be a single {} with keyword names, for ease of configuration via C

main.append(Widgets.string_input('Server', '127.0.0.1').container);

main.append(Widgets.toggle('Fullscreen').container);

var slider = Widgets.slider('Volume', {
    min: 0,
    max: 100,
    step: 1,
    value: 50
});
main.append(slider.container);
slider.load_widget();

main.append(Widgets.color_picker('Player Color', [20, 255, 200]).container);

var choices = ['Default (PulseAudio)', 'Alsa Mixer'];
main.append(Widgets.choices('Sound Devices', choices).container);

});

/* C API

    TODO --
        Widgets need onChange registered, and need to call back to C
        based on some tag
 */

function add_string_input_widget(args)
{
    $('#main').append(Widgets.string_input(args).container);
}

function add_toggle_button_widget(args)
{
    $('#main').append(Widgets.toggle(args).container);
}

function add_slider_widget(args)
{
    var slider = Widgets.slider(args);
    $('#main').append(slider.container);
    // we have to load the slider itself after appending to the dom because
    // the plugin is dumb
    slider.load_widget();
}

function add_color_picker_widget(args)
{
    $('#main').append(Widgets.color_picker(args).container);
}

function add_choice_widget(args)
{
    $('#main').append(Widgets.choices(args).container);
}

</script>

</head>

<body>

<div id="main" class="container">

<!--
  <div class="row">
    <h3>String input</h3>
    <input type="text" class="" placeholder="whatever" >
  </div>

  <div class="row">
    <h3>Toggle button</h3>
    <div class="switch" data-on="primary" data-off="primary" data-on-label="Fullscreen" data-off-label="Windowed">
      <input type="checkbox" checked />
    </div>
  </div>
-->

<!--
  <div class="row">
    <h3>Slider</h3>
    <input type="text" class="span2 slider" value="4">
  </div>
-->

<!--
  <div class="row">
    <h3>Color picker</h3>
    <button type="submit" class="btn-blank colorpicker" data-color="rgb(255, 146, 180)">Player Color</button>
  </div>
-->

<!--
  <div class="row">
    <h3>Choices</h3>
    <div class="input-append btn-group">
      <a class="btn btn-primary dropdown-toggle p" data-toggle="dropdown" href="#">
          <span id="sound-devices-label">Default (Pulseaudio)</span>
          <span class="caret"></span>
      </a>
      <ul id="sound-devices" class="dropdown-menu">
        <li><a href="#">Default (Pulseaudio)</a></li>
        <li><a href="#">Alsa Mixer</a></li>
      </ul>
    </div>
  </div>
-->

</div>

</body>
</html>
