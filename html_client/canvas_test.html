
<html>



<head>
<title>canvas test</title>

<STYLE TYPE="text/css">
canvas { 
background: #777777;
}
</STYLE>
</head>


<body>


<canvas id ="test" width="200" height="200" > </canvas>

<canvas id ="test_canvas" width="20" height="20" > </canvas>

<br> <br><br>
<img id="img3" src="http://127.0.0.1:8056/static/tiles/Bisasam_20x20_ascii.png">

<script>

    function Color_morph(x, y, value)
    {
        
        // get subimage of selected area

	var tx = value % 16;
	if(value < 16) { var ty = 0; } else { var ty = (value - tx) / 16; }
	
	sx = 20*tx;
	sy = 20*ty;

	sh = 20;
	sw = 20;
	
	/*
      var imageData = gCtx.getImageData( Math.min(gStartX, gEndX),
                                         Math.min(gStartY, gEndY),
                                         Math.abs(gEndX - gStartX),
                                         Math.abs(gEndY - gStartY));
	*/
	var canvas = document.getElementById('test_canvas');
	var context = canvas.getContext("2d");
	
	var imageData = context.getImageData(sx, sy, sh, sw);
	
      for (var x = 0; x < imageData.width; x++)
        for (var y = 0; y < imageData.height; y++)
        {
          var offset = (y * imageData.width + x) * 4;
          var r = imageData.data[offset];
          var g = imageData.data[offset + 1];
          var b = imageData.data[offset + 2];
          var alpha = imageData.data[offset + 4]; //will be unchanged
          
          // if(alpha != 1) {} //skill transparent pixels
              
        }
        //alert("Ok!");
     //context.putImageData(imageData, Math.min(gStartX, gEndX), Math.min(gStartY, gEndY));
     context.putImageData(imageData, 0, 0);
    }
    
    
	var canvas = document.getElementById("test");
	var context = canvas.getContext("2d");	
	var image = new Image();
	
	image.onload = function() {	
	//alert("start2");	
	//context.drawImage(image, 0,0);
	//alert("start3");
	Color_morph(1,1,2)
	
	sx = 20;
	sy = 0;
	sh = 20;
	sw = 20;
	
	dw = 50;
	dh = 50;
	dx =0;
	dy = 0;
	
	context.drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh);
	alert("start3");
	};
	
	image.src = "http://127.0.0.1:8056/static/tiles/Bisasam_20x20_ascii.png";
	
	alert("finished");
</script>

</body>
</html>
